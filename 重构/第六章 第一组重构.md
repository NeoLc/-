本章节介绍了作者认为的最有用的重构手段。PS：往往也是最常用的重构手段。

1、提炼函数

提炼函数时最基本也是最常用的重构方法。
只有先抽象成函数，才能将数据和数据的操作函数抽象成类，才能将一伙类抽象为模块。
可以说提炼函数是其他高级重构手法的基础。

关于这个手法，最重要的是理解，什么时候需要将一段代码提炼成函数呢？

书中有几种理由：
+ 当函数长度过长时，超过了一屏。
+ 当一段代码在重复多次出现时。
+ 当看到注释时（简直就是大大的横幅，告诉你快来把我提炼成函数）。

以上几种理由都非常有道理，但是作者人为提炼函数最大的理由是：将意图和实现分离。

程序员往往通过反复阅读一段的代码的实现从而猜测它的意图。
这个阅读的时间越长，则将这段代码提炼成函数的动机应该越强，一眼就能通过实现理解意图的代码，反而不需要提炼成函数。

所以总结一下，需要将代码提炼成函数的场景：
	• 函数过长，将一个长函数，切割为几个短函数，可读性变的更好。
	• 代码在多处重复出现，提炼重复代码，提高代码的复用性。
	• 当看到注释时，提炼函数，移除注释。
	• 通过实现来推测代码意图比较吃力时，提炼成函数，通过函数名，表达代码的意图。

这里比较关键的是函数的名字，如果想不出有意义的名字时，这可能是一个信号。
一方面你自己没想好就瞎写代码，在想法上存在很大问题，另一方面可能这段代码不适合被提炼。

最后还是要权衡下，函数提炼的收益和代价，提炼函数并不是只有好处没有坏处的重构手法。
最大的坏处就是：将一个完整的作用域割裂成了多个，并由此引出了一系列的问题，包括：
	• 不同作用域间的通信
	• 参数过多怎么办
	• 参数值or引用传递
	• 入参判断，函数返回值判断
	• 函数需要有多个返回值怎么办
	• ….

而且当函数过多时，可读性反而没有少量函数来得好。

所以要搞清楚两件事：
1、弄清楚，到底什么时候，我们需要提炼函数。
2、提炼函数的收益和成本风险的权衡。


2、内敛函数

这个标题的名字我感觉不太好，与其叫做内敛函数，不如叫做”合并函数“。

书中提到内敛函数是提炼函数的反向重构，反向重构我的理解是：重构活动的逆（反向）过程，例如：提炼函数的反向操作就是合并函数。

使用该重构手法的第一步是：判断什么时候需要使用它。

之前说过，提炼函数的最大目的在于分离代码的意图和实现，如果代码实现本身已经能够很好的表达代码的意图，那么额外的多了一层函数有害无益。

除此之外，太多的杂乱无组织的函数，会使得代码变的难以阅读，此时需要将这些函数合并起来重新进行组织以提高可读性。

所以总的来说，使用合并函数（内敛函数）手法的一般场景有两个：

	• 函数的内部实现的足够表达意图，甚至比函数名字更好。
	• 无组织的散碎函数比较多，需要合并后重新进行组织。


3、提炼变量

一段代码/一个代码块，我们可以通过提炼函数完成意图和实现的分离，从而提高代码的可读性。

如果一条表达式比较复杂难以理解，也需要通过意图和实现来提高可读性呢？此时再使用提炼函数，感觉有点杀鸡用牛刀了，我们可以使用提炼变量这一方法。
通过该变量的名字，来解释表达式的意图（含义）。

所以对于大颗粒度的代码块，通过提炼函数完成意图和实现的分离，对于小颗粒度的表达式语句，通过提炼变量完成意图和实现的分离。

提炼函数是非常简单，也是经常使用的重构手段，不要被它的名字吓到，简单一句话就是：给表达式语句赋值给局部变量。

示例如下：




很多时候书中的很多重构手法我们一直在用，只是没有将它们归纳总结，然后起个名字而已。


4、内敛变量

顾名思义，它的意思是当表达式已经足够表达它自身的意图时，此时变量就没有存在的必要了（还占内存、占地方），应该删除掉它。



需要注意：重构的手法要灵活的使用，不要生搬硬套，充满匠气的使用它，犯了教条主义的错误。要理解这个手法的内核，记住“神”，忘记“形”。

5、改变函数声明

我将它理解为修改函数签名，函数的签名包括：函数的名字、函数的参数个数和类型、函数的返回值等等。

很多时候，我们很难第一次就给函数起一个很好的名字，往往随着对软件理解的不断加深，可能会频繁的修改函数的名字。

函数的参数和返回值，是函数对外交互的窗口，和名字一样，也会随着软件开发的进度，发生变化。

总的来说，就是随着对软件的理解不断的加深，函数的名字会越来越贴切。

书中介绍了一给函数起名字的小技巧，就是先给函数写一段注释，然后再将这段注释浓缩成一个名字。

6、封装变量



对于熟悉面向对象的同行来说这是非常常见的手法，因为对于数据的访问保护是俺们的常识。

而get/set可以很好的把数据的检查、保护、跟踪逻辑放置到数据访问函数中。

我个人对这方面的理解并不深，但是无论是从函数式编程极端的强调数据不变性，函数面向对象的对数据的private私有限制，还是各种编程范式对数据的封装/分离/隔离，

都在告诉我们对数据的访问/处理不是一个简单的活，应该谨慎的处理。

书中对于封装变量给了几个理由，其中一些我没怎么搞明白，所以也写不出来啥东西。

但是有一点我非常认同：作用域范围越大的数据，封装的重要性就越大。

7、变量改名

变量改名和前面的函数改名是遥相呼应的。还是为了更强的表达力，更好的意图理解。



无论是函数改名，还是变量改名，如果修改的地方比较多，且修改的风险比较大。

那么可以新的函数、新的变量应该先以副本的形式存在，而不是直接修改旧函数/旧变量，在替换新函数/变量测试OK之后，再移除旧的。

8、引入参数对象



同样是耳熟能详的重构手法，将一组数据封装为一个数据结构，最明显的好处是可以缩短函数的参数个数。

不过作者想表达的真正意思，是识别软件中具有特殊意义的一组数据，将其进行封装，从而改变和这团数据进行交互的所有逻辑。

将数据封装成数据结构是非常简单的手法，但是如何识别，改不进行封装的判断比较难下。

9、函数组合类



该重构手法也是非常常见的，我希望知道一些很有用，但是我不知道的重构手法，或者某些已知重构手法中我所不知道的高级技巧。

函数组合成类，是将一组密切关联的数据和数据操作封装成类的方法，该手法没啥难度。

难的点在于，怎么样有意识的将合适的函数和数据封装起来，这点书中没有做介绍，怕是需要练习和经验。

10、函数组合变换



从上图看，函数组合变换和内敛函数很像，都是将多个函数合并成一个函数，其实不然。

仔细观察可以看出，这两个函数的入参是一样的。

作者想表达的真正思想是：数据和数据的处理最要放在一起。

例如如果好多个函数，都需要处理同一个数据，或者一个数据可能会都和函数进行处理。

当然，这种情况也可以通过组合类来解决，将数据封装为成员变量，函数封装为成员函数。


我感觉关于这个重构方法，作者说的并不是特别透彻，我们还是理解其中的思想即可，数据和数据的处理最好放在一起。

书中的各种手法没必要死记硬背，重点是理解其背后的思想。

11、拆分阶段

函数拆分也是非常常见的重构技巧，当一个函数做了两件事时，需要将其拆分为两个函数。

这种做法有什么好处呢？背后的思想又是什么？ -- 注意力聚焦。

人的大脑结构决定了，人很难同时处理多件事，也挺难同时理解多件事。

所以进行模块划分、功能划分，可以使得功能专一，做到注意力聚焦，不用关心其他模块的细节。


=========================================================================================================================================================

作者列出的最常用的重构手法我基本都用过，它们背后的思想总结来说就是：

	• 实现和意图最好分离，通过名字来表达代码实现的意图。
	• 数据和数据操作最好放在一起。
	• 功能要专一，这样有利于注意力的聚焦。
